# PA 2-4 Kidd 解题报告

## 1.数据结构 ##

* 线段树
* 采用完全二叉树紧凑表示法，以数组存储节点
* 对数据进行离散化，节点中只存储输入坐标
* 区间左闭右开

## 2.算法原理 ##

1. 由于牌数很大但实际访问的数量较小，可以对数据进行离散化，也即根据输入将多个节点合并为一个节点。因为输入时没有访问端点之间的数据，节点内部的翻转情况是一致的，不需继续细分。
2. 在翻转时使用懒惰标记：如果当前节点范围在翻转范围之内则不需递归访问子节点，将翻转情况统一记录即可。在访问区间打破节点内部的一致性时再将懒惰标记清零并下传翻转情况，递归访问子节点。

## 3.实现要点 ##

1. 读入操作与访问值，记录并对坐标排序去重，基于此建立线段树，将对应内容存入节点并递归初始化子节点。
2. 根据记录进行操作 ：
   * 翻转：若节点范围在访问范围之内使用懒惰标记记录，否则下传懒惰标记；若有子节点且子节点与访问范围相交则递归访问子节点并更新翻转情况。
   * 查询：若节点范围在访问范围之内，获取懒惰标记记录，否则下传懒惰标记；若有子节点且子节点与访问范围相交则递归访问子节点并更新翻转情况。

## 4.解题过程中的问题与技巧

1. 出现WA时随机生成测例，绘图分析debug
2. 最初在计算时没有将int转为long  long， 造成错误
3. 使用完全二叉树紧凑表示，存储空间连续，使操作更加简便高效

## 5.复杂度分析 ##

(1)时间复杂度

1. 建树 等同于二叉树前序遍历，复杂度为O(m)
2. 翻转、查询 每一层访问节点中间部分会因懒惰标记机制停止递归，递归的节点最多为访问节点最左端与最右端的节点，因此下一层访问节点最多为4个。归纳而言每一层访问节点不超过4个，因此每一次访问复杂度为`O(log(m))`，共计`O(mlog(m))`。

因此时间复杂度为`O(mlog(m))`。

(2)空间复杂度

线段树数组采用完全二叉树紧凑表示，另有存储端点坐标、操作类型的数组，空间复杂度合计为O(m).

## 6.参考资料

参考讲义中数组去重算法实现。
